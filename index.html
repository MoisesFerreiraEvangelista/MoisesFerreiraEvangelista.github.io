<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Mapa Fácil</title>
    <!-- meta -->
    <meta name="msapplication-TileColor" content="#0e2137">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />


    <!-- PWA -->
    <link rel="manifest" href="manifest.json">

    <!-- realfavicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon_package/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon_package/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon_package/favicon-16x16.png">
    <link rel="mask-icon" href="/favicon_package/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#2b5797">
    <meta name="theme-color" content="#ffffff">



    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" integrity="sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ=="
        crossorigin="" />
    <link rel="stylesheet" href="/css/flatly/bootstrap.css">

    <link rel="shortcut icon" href="/app-images/images/icons/icon-512x512.png">
    <!-- Material icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">


    <style>
        #location-map {
            background: #fff;
            border: none;
            height: 600px;
            width: 100%;

            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
        }

        .leaflet-control-zoom {
            display: none;
        }
    </style>
</head>

<body>
    <!-- <div class="visible-xs">
        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"
                        aria-expanded="false">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">Mapa Fácil</a>
                </div>
                <p id="coordenadas" class="navbar-text text-white navbar-right"></p>

                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

                    <form class="navbar-form navbar-left">
                        <div class="form-group ">
                            <input type="text" required class="form-control" id="endereco" type="text" placeholder="Informe o endereço" name="address">
                        </div>
                        <input type="submit" value="Localizar" class="btn btn-default btn-small">
                        <input type="reset" value="Limpar" class="btn btn-default btn-small">
                        <button id="meu-local" type="button" class="btn btn-default btn-small">
                            Meu local
                        </button>
                    </form>
                </div>
            </div>
        </nav>
    </div> -->

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <a class="navbar-brand" href="#">Mapa Fácil</a>

    </nav>



    <!-- <div class="visible-lg visible-md visible-sm"> -->
    <div class="card ">
        <div class="card-body">
            <h5 class="text-muted ">Informe um endereço ou click no mapa</h5>
            <form>
                <div class="form-group">
                    <input id="endereco" type="text" placeholder="Informe o endereço" name="address" class="form-control form-control-success">
                </div>
                <!-- <input type="submit" value="Localizar" class="btn btn-primary"> -->
                <button type="submit" class="btn btn-primary btn-sm">
                    <i class="fa fa-search"></i> Buscar</button>
                <!-- <input type="reset" value="Limpar" class="btn btn-primary"> -->
                <button type="reset" class="btn btn-default btn-sm">
                    <i class="fa fa-eraser"></i> Limpar</button>
                <button id="meu-local" type="button" class="btn btn-success btn-sm">
                    <i class="fa fa-street-view"></i> Meu local
                </button>
                <button id="rect" type="button" class="btn btn-primary btn-sm">
                    <i class="fa fa-microphone"></i> Falar</button>

                <br>
                <br>

                <label id="coordenadas"></label>
            </form>
            <div id="location-map"></div>
        </div>
    </div>

    <!-- </div> -->
    <!--Start of Tawk.to Script-->
        <script type="text/javascript">
        var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
        (function(){
        var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
        s1.async=true;
        s1.src='https://embed.tawk.to/5d17ab967a48df6da2422f5a/default';
        s1.charset='UTF-8';
        s1.setAttribute('crossorigin','*');
        s0.parentNode.insertBefore(s1,s0);
        })();
        </script>
    <!--End of Tawk.to Script-->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143007513-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-143007513-2');
    </script>


    <script>

        // document.addEventListener('DOMContentLoaded', function () {
        //     var elems = document.querySelectorAll('.fixed-action-btn');
        //     var options = {
        //         direction: 'top',
        //         hoverEnabled: false
        //     }
        //     var instances = M.FloatingActionButton.init(elems, options);
        // });

        // Or with jQuery

        // $(document).ready(function () {
        //     $('.fixed-action-btn').floatingActionButton();
        // });
    </script>
    <script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0"
        crossorigin="anonymous"></script>



    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js" integrity="sha512-A7vV8IFfih/D732iSSKi20u/ooOfj/AGehOKq0f4vLT1Zr2Y+RX7C+w8A1gaSasGtRUZpF/NZgzSAu4/Gc41Lg=="
        crossorigin="">
        </script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>

    <script type="text/javascript">

        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })

        var latitudeInicial = -8.771930100073316;
        var longitudeInicial = -63.88318061828614;
        var map = L.map('location-map').setView([latitudeInicial, longitudeInicial], 15);
        var mapLink = '<a href="https://openstreetmap.org">OpenStreetMap</a>';
        L.tileLayer(
            'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Map data &copy; ' + mapLink,
                maxZoom: 20
            }).addTo(map);
        var marker = L.marker([latitudeInicial, longitudeInicial]).addTo(map);
        AtribuirEventoClick();


        function Localizar(lat, lng) {

            //console.log('Localizar ' + lat + ',' + lng);
            map.remove();
            map = L.map('location-map').setView([lat, lng], 17);
            mapLink = '<a href="https://openstreetmap.org">OpenStreetMap</a>';
            L.tileLayer(
                'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'Map data &copy; ' + mapLink,
                    maxZoom: 20,
                }).addTo(map);
            marker = L.marker([lat, lng]).addTo(map);

            AtribuirEventoClick();
        }

        $('form').submit(function (e) {
            e.preventDefault();
            url = 'https://maps.googleapis.com/maps/api/geocode/json?' + $(this).serialize() + '&key=AIzaSyA1fbIyTXHRaQkA-WQgdfrmE4MCesoqEXI';
            $('#coordenadas').html('<i class="fa fa-spinner fa-spin"></i> Buscando endereço...');
            AtualizarPara(url, true);
        })

        function AtribuirEventoClick() {
            map.on('click', function (e) {
                if (marker) {
                    map.removeLayer(marker);
                }
                marker = new L.Marker(e.latlng).addTo(map);

                var latitude = e.latlng.lat;
                var longitude = e.latlng.lng;

                url = 'https://maps.googleapis.com/maps/api/geocode/json?address=' + latitude + ', ' + longitude + '&key=AIzaSyA1fbIyTXHRaQkA-WQgdfrmE4MCesoqEXI';

                AtualizarPara(url);

            });
        };

        function AtualizarPara(url, localizar) {
            $('#coordenadas').html('<i class="fa fa-spinner fa-spin"></i> Buscando endereço...').css("color", "initial");
            $.get(url)
                .done(function (data) {
                    console.log(data);
                    if (data.error_message) {
                        //console.log(data.error_message);
                        $('#coordenadas').text('Ops! Algo deu errado, refaça a operação').css("color", "crimson");
                    } else {
                        resultado = data.results[0];
                        endereco = resultado.formatted_address;
                        latitude = resultado.geometry.location.lat;
                        longitude = resultado.geometry.location.lng;
                        if (localizar) {
                            Localizar(latitude, longitude);
                        }
                        informacoes = "Endereço encontrado: " + endereco + " Latitude: " + latitude + " Longitude: " + longitude;
                        $('#coordenadas').text(informacoes).css("color", "darkblue");
                        // $('#bs-example-navbar-collapse-1').collapse('toggle');
                    }
                })
                .fail(function (data) {
                    alert('Ops! Algo deu errado, refaça a operação');
                    $('#coordenadas').text('');
                })
        }

        $('#meu-local').click(function () {

            //console.log('asd');
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) { // callback de sucesso
                    // ajusta a posição do marker para a localização do usuário
                    //marker.setPosition(new google.maps.LatLng(position.coords.latitude, position.coords.longitude));
                    //console.log('entrou em navigator.geolocation.getCurrentPosition')    ;      
                    //console.log(position);
                    var latitude = position.coords.latitude;
                    var longitude = position.coords.longitude;

                    url = 'https://maps.googleapis.com/maps/api/geocode/json?address=' + latitude + ', ' + longitude + '&key=AIzaSyA1fbIyTXHRaQkA-WQgdfrmE4MCesoqEXI';
                    AtualizarPara(url, true);
                },
                    function (error) { // callback de erro

                        //console.log('Erro ao obter localização.', error);
                    });
            } else {
                //console.log('Navegador não suporta Geolocalização!');
                alert('Navegador não suporta Geolocalização!');
            }
        })
    // verifica se o navegador tem suporte a geolocalização
    </script>
    <script src="SpeechRecognition.js"></script>
    <!-- Uncomment the line below when ready to test with fake data -->
    <script src="js/app.js" async></script>
</body>
</body>

</html>
